Vagrant.configure("2") do |config|

  # This eases VirtualBox Guest Additions installation.
  config.vagrant.plugins = "vagrant-vbguest"

  # Juice Shop is our pretend Blue Team for this scenario.
  # This is just yanked from Juice Shop's own Vagrantfile.
  # I.e., keep this more-or-less aligned with whatever is
  # in `./Blue Team/vagrant/Vagrantfile`.
  config.vm.define "blue" do |c|
    c.vm.box = "ubuntu/xenial64"
    c.vm.hostname = "juice.sh"
    c.vm.network "private_network", ip: "192.168.33.10"
    c.vm.provision "file", source: "./Blue Team/vagrant/default.conf", destination: "/tmp/juice-shop/default.conf"
    c.vm.provision :shell, path: "./Blue Team/vagrant/bootstrap.sh"

    # We don't need VBox Guest Additions for the server.
    c.vbguest.auto_update = false
  end

  # Any Debian-derived GNU/Linux will do. We just need OWASP ZAP.
  config.vm.define "red" do |c|
    c.vm.box = "debian/buster64"
    c.vm.network "private_network", ip: "192.168.33.11"
    c.vm.provision "shell", path: "./Red Team/provision.sh"
    c.vm.provider "virtualbox" do |v|
      # ZAP is a graphical Java app, so let's give it some help.
      v.memory = 2048
      v.customize ["modifyvm", :id, "--vram", "128"]
      v.customize ["modifyvm", :id, "--graphicscontroller", "vmsvga"]
    end

    c.vm.post_up_message = <<~EOF
      OWASP ZAP is a graphical application, so you'll need to log in
      via the machine's GUI console.

      The username is: vagrant
      The password is: vagrant

      Once logged in, start the OWASP Zed Attack Proxy by clicking on
      the Applications menu and selecting Other -> ZAP from the menu.

      Your practice target is located at IP address 192.168.33.10.
    EOF
  end

end
